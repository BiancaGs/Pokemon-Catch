<!DOCTYPE html>
<html lang="en">
    
    <head>
        
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Modelagem 3D em WebGL</title>

        <!-- Arquivos necessários -->
        <script src="node_modules/three/build/three.js"></script>
        <script src="node_modules/three/examples/js/WebGL.js"></script>
        <script src="node_modules/three/examples/js/loaders/OBJLoader.js"></script>
        <script src="node_modules/three/examples/js/loaders/MTLLoader.js"></script>
        <script src="node_modules/three/examples/js/controls/OrbitControls.js"></script>

    </head>
    
    <body>

        <!-- Canvas para exibição do modelo -->
        <canvas id="modelo"></canvas>

        <!-- Vertex Shader -->
        <script id="vertex-shader" type="x-shader/x-vertex">
            
        </script>

        <!-- Fragment Shader -->
        <script id="fragment-shader" type="x-shader/x-fragment">

        </script>


        <!-- Código para manipulação -->
        <script>
        
            // Verifica se foi possível inicializar o WebGL
            if (!WEBGL.isWebGLAvailable()) {
                var erro = WEBGL.getWebGLErrorMessage();
                alert(erro);
            }

            // Variáveis para utilização posterior
            var container;
            var camera, controls, scene, renderer;
            var ambient;
            var light;
            var canvas = document.getElementById('modelo');
          
            // Chamadas
            init();
            animate();


            // =======================================================
            // FUNÇÕES
            // =======================================================

            // Função init
            function init() {

                // =======================================================
                // Recuperação do canvas
                // =======================================================

                container = document.createElement('div');
                document.body.appendChild(container);

                // =======================================================
                // Camera
                // =======================================================

                camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.01, 1000); //1000
                camera.position.x = 4;
                camera.position.y = 4;
                camera.position.z = 0;
                
                // =======================================================
                // Cena
                // =======================================================

                scene = new THREE.Scene();
                ambient = new THREE.AmbientLight(0xcccccc, 0.4);//(0xffffff, 1.0);
                
                scene.add(ambient);
                scene.add(camera);

                // =======================================================
                // Modelo
                // =======================================================
                
                var mtl = new  THREE.MTLLoader;
                mtl.setPath('assets/');
                mtl.load('ivysaur/Pokemon.mtl', function(materials) {

                    materials.preload();

                    var obj = new THREE.OBJLoader;
                    obj.setMaterials(materials);
                    obj.setPath('assets/');
                    obj.load('ivysaur/Pokemon.obj', function(object) {
                        scene.add(object);
                    });

                });

                // =======================================================
                // Renderizador
                // =======================================================

                renderer = new THREE.WebGLRenderer({
                    canvas: canvas, 
                    antialias: true
                });
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setClearColor(new THREE.Color('white'));

                container.appendChild(renderer.domElement);

                // =======================================================
                // Controles
                // =======================================================

                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.25;
                controls.enableZoom = false;

            }

            // Função animate
            function animate(){
                requestAnimationFrame(animate);
                render();
            }

            // Funcão render
            function render() {
                camera.lookAt(scene.position);
                renderer.render(scene, camera);
            }

        </script>

    </body>

</html>